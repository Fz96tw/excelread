version: "3.9"

services:

  namecheap_ddns:
    image: curlimages/curl:latest
    container_name: namecheap_ddns
    restart: unless-stopped
    entrypoint: >
      /bin/sh -c "while true;
        do
          curl -s \"https://dynamicdns.park-your-domain.com/update?host=poc&domain=cloudcurio.com&password=9e6c63261fec47b9a2baa765fda4e375&ip=$(curl -s ifconfig.me)\";
          sleep ${INTERVAL:-600};
        done"
    environment:
      - HOST=@                            # âœ… FIXED (was 'app=' before)
      - DOMAIN=cloudcurio.com
      - PASSWORD=2c3fead7c88a4613b1b0b3ca4e9639e8
      - INTERVAL=600

  nginxproxymanager:
    image: jc21/nginx-proxy-manager:latest
    container_name: nginx_proxy_manager
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
      - "81:81"
    volumes:
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt
    networks:
      - appnet

  ollama:
    image: fz96tw/llama3.2-1b:v1
    container_name: llama
    ports:
      - "11434:11434"
    restart: unless-stopped
    networks:
      - appnet

  ai-connector:
    image: ai-connector:latest
    container_name: ai-connector
    ports:
      - "5000:5000"
    depends_on:
      - summarizer
    networks:
      - appnet
    volumes:
      - config:/appnew/config
      - /c:/mnt/c
      - /home/nadeem/github/excelread/logs:/appnew/logs
      - /home/nadeem/github/excelread/config:/appnew/config_local  # just so i can write contactus.messages.txt

    environment:
      - SUMMARIZER_HOST=http://summarizer:8000

  summarizer:
    image: summarizer
    container_name: summarizer
    ports:
      - "8000:8000"
    depends_on:
      - ollama
    networks:
      - appnet
    volumes:
      - config:/summarizer/config
    environment:
      - OLLAMA_HOST=http://ollama:11434


  #-------------------------------
  # ðŸ§  GoAccess + Nginx Dashboard
  # -------------------------------
  goaccess:
    #image: allinurl/goaccess
    image: allinurl/goaccess:1.8
    container_name: goaccess_npm
    restart: unless-stopped
    volumes:
      - ./data/logs:/srv/logs:ro                # NPM logs
      - ./goaccess/report:/srv/report
      - ./goaccess/goaccess.conf:/srv/goaccess.conf:ro
      - ./goaccess/start.sh:/start.sh:ro
    entrypoint: ["/bin/sh", "/start.sh"]
    ports:
      - "7890:7890"
    expose:
      - "7890"
    networks:
      - appnet

  goaccess_nginx:
    image: nginx:alpine
    container_name: goaccess_nginx
    restart: unless-stopped
    volumes:
      - ./goaccess/report:/usr/share/nginx/html:ro       # Serve GoAccess reports
    ports:
      - "8890:80"                               # Access http://localhost:8890
    depends_on:
      - goaccess
    networks:
      - appnet

networks:
  appnet:
    driver: bridge

volumes:
  config:

  

  