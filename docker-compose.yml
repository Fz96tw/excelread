version: "3.9"

services:

  ollama:
    image: fz96tw/llama3.2-1b:v1   # prebuilt Ollama image
    container_name: llama
    ports:
      - "11434:11434"           # default Ollama API port
    restart: unless-stopped
    networks:
      - appnet

  ai-connector:
    image: fz96tw/ai-connector:v1  # must be built/tagged ahead of time
    ports:
      - "5000:5000"
    depends_on:
      - summarizer
    networks:
      - appnet
    volumes:
      - config:/appnew/config
      - /c:/mnt/c         

    environment:
      - SUMMARIZER_HOST=http://summarizer:8000

  summarizer:
    image: fz96tw/summarizer:v1    # must be built/tagged ahead of time
    ports:
      - "8000:8000"
    depends_on:
      - ollama
    networks:
      - appnet
    volumes:
      - config:/summarizer/config
    environment:
      - OLLAMA_HOST=http://ollama:11434
    
networks:
  appnet:
    driver: bridge

volumes:
  config:
